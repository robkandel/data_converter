/*//////////////////////////////////////////////////||
// ROB KANDEL										||
// kandelrob@gmail.com								||
//													||
// created 11.06.14	| updated 11.08.14				||
// data_converter.min.js							||
// version 0.0.1									||
////////////////////////////////////////////////////*/


var convert_data=(function(){var a={init:function(){a.reset_options();a.setup_buttons();a.setup_drag_drop()},reset_options:function(){jQuery("#content_input_data").val("");jQuery("#content_output_data").val("");a.setup_textareas()},setup_buttons:function(){jQuery(".optionWrapper").find(".optionButton").each(function(){if(typeof jQuery(this).attr("data-property")!==typeof undefined&&jQuery(this).attr("data-property")!==false){jQuery(this).on("click",function(){var b=jQuery(this).attr("data-property");if(!jQuery(this).hasClass("optionButtonActive")&&!jQuery(this).hasClass("optionButtonNotActive")){jQuery(".optionButtonActive").removeClass("optionButtonActive");jQuery(this).addClass("optionButtonActive");if(jQuery("#content_input_data").val()!=""){a.toggle_output_type(b)}if(jQuery('li[data-role="option_dropdown"]').hasClass("optionDropdownActive")){jQuery('li[data-role="option_dropdown"]').removeClass("optionDropdownActive");jQuery('ul[data-role="output_wrapper"]').removeClass("outputWrapperActive")}}})}});jQuery('li[data-role="option_dropdown"]').on("click",function(){if(jQuery('li[data-role="option_dropdown"]').hasClass("optionDropdownActive")){jQuery('li[data-role="option_dropdown"]').removeClass("optionDropdownActive");jQuery('ul[data-role="output_wrapper"]').removeClass("outputWrapperActive")}else{jQuery('li[data-role="option_dropdown"]').addClass("optionDropdownActive");jQuery('ul[data-role="output_wrapper"]').addClass("outputWrapperActive")}})},setup_textareas:function(){jQuery("#content_input_data").bind("input propertychange",function(){if(jQuery("#content_input_data").val()!=""){a.toggle_output_type(jQuery(".optionButtonActive").attr("data-property"));jQuery('div[data-role="container_split"]').addClass("containerSplitActive");jQuery("#content_data_output").removeClass("contentHidden")}else{jQuery("#content_data_output").addClass("contentHidden");jQuery('div[data-role="container_split"]').removeClass("containerSplitActive")}});var b=document.getElementById("content_output_data");b.onfocus=function(){b.select();b.onmouseup=function(){b.onmouseup=null;return false}}},toggle_output_type:function(b){if(b!="table"&&b!="xml"&&b!="kml"){jQuery("#content_output_data").val(JSON.stringify(parse_csv_json.init(jQuery("#content_input_data").val(),b)))}else{parse_csv_json.init(jQuery("#content_input_data").val(),b);jQuery("#content_output_data").val(jQuery("#table_converter").html())}},setup_drag_drop:function(){document.getElementById("content_data_drag").addEventListener("dragover",a.handle_drag_over,false);document.getElementById("content_data_drag").addEventListener("dragleave",a.handle_drag_out,false);document.getElementById("content_data_drag").addEventListener("dragend",a.handle_drag_out,false);document.getElementById("content_data_drag").addEventListener("drop",a.handle_file_selection,false)},handle_drag_over:function(b){jQuery("#content_data_drag").addClass("contentDragableHover");b.stopPropagation();b.preventDefault()},handle_drag_out:function(b){jQuery("#content_data_drag").removeClass("contentDragableHover");b.stopPropagation();b.preventDefault()},handle_file_read_abort:function(b){alert("File read aborted.")},handle_file_read_error:function(b){var c;switch(b.target.error.name){case"NotFoundError":alert("The file could not be found!");break;case"SecurityError":c="A file security error occured. This can be due to:";c+="Accessing certain files deemed unsafe for Web applications.";c+="The file has changed on disk since the user selected it.";alert(c);break;case"NotReadableError":alert("The file cannot be read. This can occur if the file is open in another application.");break;case"EncodingError":alert("The length of the data URL for the file is too long.");break;default:alert("File error code "+b.target.error.name)}},start_file_read:function(c){var b=new FileReader();if(c.type.match("text/csv")){b.onloadend=a.display_file_text}else{if(c.type.match("text/kml")||c.name.indexOf(".kml")!=-1){b.onloadend=a.display_kml_text}}b.onerror=a.handle_file_read_error;if(c){b.readAsText(c)}},handle_file_selection:function(b){jQuery("#content_data_drag").removeClass("contentDragableHover");b.stopPropagation();b.preventDefault();if(b.type.toString().toLowerCase()=="change"){var e=b.target.files}else{var e=b.dataTransfer.files}if(!e){alert("At least one selected file is invalid - do not select any folders.</p><p>Please reselect and try again.");return}for(var d=0,c;c=e[d];d++){if(!c){alert("Unable to access "+c.name);return false}if(c.size==0){alert(c.name.toUpperCase()+" is empty");return false}if(c.size>=1048576){alert(c.name.toUpperCase()+" is too big. Files must be under 1MB");return false}if(!c.type.match("text/csv")&&c.name.indexOf(".csv")==-1&&!c.type.match("text/kml")&&c.name.indexOf(".kml")==-1){alert(c.name.toUpperCase()+" is not a csv, please only select a csv file");return false}a.start_file_read(c)}},display_file_text:function(b){var c=b.target.result;jQuery("#content_input_data").val(c);a.toggle_output_type(jQuery(".optionButtonActive").attr("data-property"));jQuery('div[data-role="container_split"]').addClass("containerSplitActive");jQuery("#content_data_output").removeClass("contentHidden")},display_kml_text:function(b){var c=b.target.result;jQuery("#content_input_data").val(c);jQuery(".optionButtonActive").removeClass("optionButtonActive");jQuery(".optionWrapper").find(".optionButton").each(function(){if(typeof jQuery(this).attr("data-property")!==typeof undefined&&jQuery(this).attr("data-property")!==false){jQuery(this).addClass("optionButtonNotActive")}});jQuery("li[data-role='option_5']").removeClass("optionButtonNotActive").addClass("optionButtonActive");jQuery("#content_output_data").val(JSON.stringify(toGeoJSON.kml(jQuery.parseXML(c))));jQuery('div[data-role="container_split"]').addClass("containerSplitActive");jQuery("#content_data_output").removeClass("contentHidden")}};return a})();